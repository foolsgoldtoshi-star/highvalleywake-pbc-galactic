{:paths ["site-dsl/src" "scripts"]
 :deps  {org.clojure/clojurescript {:mvn/version "1.11.132"}
         http-kit/http-kit        {:mvn/version "2.8.0"}
         babashka/fs              {:mvn/version "0.5.20"}
         zprint/zprint            {:mvn/version "1.2.9"}}
 :tasks
 { :requires ([babashka.fs :as fs]
              [babashka.process :refer [process shell]]
              [clojure.string :as str])
  doctor {:doc "Check toolchain availability"
          :task (do (println "bb" (System/getProperty "babashka.version"))
                    (shell "bash" "-lc" "node --version || true")
                    (shell "bash" "-lc" "clojure -Sdescribe | head -n 5 || true")
                    (shell "bash" "-lc" "npx vite --version || true")
                    (shell "bash" "-lc" "clj-kondo --version || true")
                    (shell "bash" "-lc" "zprint --version || true"))}
  fmt {:doc "Format with zprint (80 cols)"
       :task (shell "bash" "-lc" "zprint -w **/*.{clj,cljs,edn,bb,md} || true")}
  fmt:check {:doc "Check formatting"
             :task (shell "bash" "-lc" "git diff --quiet || (git status --porcelain; exit 1)")}
  lint {:doc "Lint"
        :task (shell "bash" "-lc" "clj-kondo --lint site-dsl scripts")}
  build:gen {:doc "Parse docs -> Svelte + JSON"
             :task (shell {:dir "site-dsl"} "bash" "-lc" "bb -m site.core")}
  build:bundle {:doc "Vite bundle"
                :task (shell {:dir "web"} "bash" "-lc" "npm pkg get name >/dev/null 2>&1 || npm init -y; npm i -D svelte @sveltejs/vite-plugin-svelte vite; npx vite build")}
  build:all {:depends [build:gen build:bundle]}
  serve {:doc "Serve static site"
         :task (shell "bash" "-lc" "bb scripts/serve.clj")}
  pages:build {:doc "Build for GitHub Pages"
               :task (shell {:dir "web"} "bash" "-lc" "BASE_PATH=${BASE_PATH:-/} npx vite build")}
  pages:bundle {:depends [build:gen pages:build]}
  usdc:solana:ping {:doc "Placeholder" :task (println "TODO: solana-clj/web3.js")}
  usdc:ethereum:ping {:doc "Placeholder" :task (println "TODO: ethers.js")}
  ci:verify {:depends [doctor lint build:gen]}}}
