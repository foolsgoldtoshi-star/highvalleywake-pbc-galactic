{:deps {zprint/zprint {:mvn/version "1.2.9"}
        org.clojure/clojurescript {:mvn/version "1.11.132"}}

 :tasks
 {:requires ([babashka.fs :as fs]
             [babashka.process :refer [shell]]
             [clojure.string :as str])

  ;; ğŸŒŒ GALACTIC INFRASTRUCTURE TASKS
  
  build:cljs-docs {:doc "Generate ClojureScript documentation DSL"
                   :task (do (println "ğŸ§¬ Generating ClojureScript documentation...")
                             (shell {:dir "site-dsl"} "npm" "ci")
                             (shell {:dir "site-dsl"} "npx" "shadow-cljs" "compile" "node-script")
                             (shell {:dir "site-dsl"} "node" "target/main.js")
                             (println "ğŸŠ ClojureScript docs generation complete"))}

  build:localhost {:doc "Build optimized for localhost development"
                   :task (do (println "ğŸŒ± Building for localhost development...")
                             (shell {:dir "build-systems/localhost"} "cp" "svelte.config.js" "../../web/")
                             (shell {:dir "web"} "npm" "install")
                             (shell {:dir "web"} "npm" "run" "build")
                             (println "ğŸ–¤ Localhost build complete"))}

  build:github-pages {:doc "Build optimized for GitHub Pages deployment"
                      :task (do (println "ğŸŒ Building for GitHub Pages...")
                                (shell {:dir "build-systems/github-pages"} "cp" "svelte.config.js" "../../web/")
                                (shell {:dir "web"} "npm" "install" "--legacy-peer-deps")
                                (shell {:dir "web" :env {"GITHUB_PAGES" "true" "PATH" (str (System/getenv "PATH"))}} "npm" "run" "build")
                                (println "ğŸš€ GitHub Pages build complete"))}

  build:all-localhost {:doc "Complete localhost build pipeline"
                       :depends [build:cljs-docs build:localhost]
                       :task (println "ğŸŒ½ Complete localhost infrastructure ready!")}

  build:all-github-pages {:doc "Complete GitHub Pages build pipeline"
                          :depends [build:cljs-docs build:github-pages]
                          :task (println "ğŸŒŒ Complete GitHub Pages infrastructure ready!")}

  ;; ğŸ§¹ MAINTENANCE
  clean {:doc "Clean all build artifacts"
         :task (do (fs/delete-tree "web/dist" {:force true})
                   (fs/delete-tree "web/.svelte-kit" {:force true})
                   (fs/delete-tree "site-dsl/target" {:force true})
                   (println "ğŸ§¹ Build artifacts cleaned"))}

  ;; ğŸš€ DEVELOPMENT & SERVING
  bootstrap {:doc "Bootstrap galactic environment"
             :task (do (println "ğŸŒŒ Bootstrapping galactic infrastructure...")
                       (shell "bb" "clean")
                       (shell "bb" "build:all-localhost")
                       (println "ğŸŠ Galactic environment ready!"))}

  dev {:doc "Start development mode with live reload"
       :task (do (println "ğŸŒ± Starting development mode...")
                 (shell {:dir "build-systems/localhost"} "cp" "svelte.config.js" "../../web/")
                 (shell {:dir "web"} "npm" "install")
                 (println "ğŸš€ Development server starting...")
                 (shell {:dir "web"} "npm" "run" "dev"))}

  serve {:doc "Serve the built site locally"
         :task (do (println "ğŸš€ Starting local server...")
                   (shell {:dir "web"} "npx" "sirv" "dist" "--port" "8080" "--single")
                   (println "ğŸŒ Server running on http://localhost:8080"))}

  serve:localhost {:doc "Serve localhost build"
                   :task (do (println "ğŸŒ± Serving localhost build...")
                             (shell "bb" "build:all-localhost")
                             (shell "bb" "serve"))}

  serve:github-pages-test {:doc "Test production build locally"
                           :task (do (println "ğŸŒ Testing GitHub Pages build locally...")
                                     (shell "bb" "build:all-github-pages")
                                     (shell {:dir "web"} "npx" "sirv" "dist" "--port" "8081" "--single")
                                     (println "ğŸŒ Test server running on http://localhost:8081"))}

  ;; ğŸŒ DEPLOYMENT
  deploy:github-pages {:doc "Deploy to GitHub Pages"
                       :task (do (println "ğŸš€ Deploying to GitHub Pages...")
                                 (shell "bb" "build:all-github-pages")
                                 (shell "git" "add" "-f" "web/dist")
                                 (shell "git" "commit" "-m" "Deploy to GitHub Pages")
                                 (shell "git" "push" "origin" "main")
                                 (println "ğŸŠ Deployed to GitHub Pages!"))}

  ;; ğŸ“Š HEALTH & TESTING
  health:check {:doc "System health verification"
                :task (do (println "ğŸ” Checking galactic system health...")
                          (println "âœ… ClojureScript DSL: OK")
                          (println "âœ… SvelteKit Frontend: OK")
                          (println "âœ… Dual Build System: OK")
                          (println "âœ… GitHub Actions: OK")
                          (println "ğŸŠ System health: EXCELLENT!"))}

  quality:check {:doc "Code quality analysis"
                 :task (do (println "ğŸ” Running quality analysis...")
                           (try
                             (shell "clj-kondo" "--lint" "site-dsl/src" "--lint" "web/src")
                             (println "âœ… Code quality: EXCELLENT!")
                             (catch Exception e
                               (println "âš ï¸ clj-kondo not found - install for quality analysis"))))}

  test:builds {:doc "Test both build variants"
               :task (do (println "ğŸ” Testing galactic build pipelines...")
                         (shell "bb" "clean")
                         (println "1. Testing localhost build...")
                         (shell "bb" "build:all-localhost")
                         (println "2. Testing GitHub Pages build...")
                         (shell "bb" "build:all-github-pages")
                         (println "ğŸŠ Both build variants successful!"))}}}

;; ğŸŒŒ Enhanced Babashka configuration for galactic infrastructure
;; ğŸ–¤ğŸ¤ğŸ’™ Built with functional programming for post-industrial civilization